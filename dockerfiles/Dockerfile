FROM node:18-alpine3.16 as build

ARG REACT_APP_ENVIRONMENT
ARG REACT_APP_API_URL
ARG REACT_APP_SENTRY_DSN

ARG REACT_APP_CLIMATE_API_BASE_URL_DEV
ARG REACT_APP_CLIMATE_API_PUBLIC_KEY_DEV
ARG REACT_APP_CLIMATE_API_PRIVATE_KEY_DEV
ARG REACT_APP_CLIMATE_STATION_ID_DEV

ENV REACT_APP_ENVIRONMENT=${REACT_APP_ENVIRONMENT:-local}
ENV REACT_APP_API_URL=${REACT_APP_API_URL}
ENV REACT_APP_SENTRY_DSN=${REACT_APP_SENTRY_DSN}

ENV REACT_APP_CLIMATE_API_BASE_URL_DEV=${REACT_APP_CLIMATE_API_BASE_URL_DEV}
ENV REACT_APP_CLIMATE_API_PUBLIC_KEY_DEV=${REACT_APP_CLIMATE_API_PUBLIC_KEY_DEV}
ENV REACT_APP_CLIMATE_API_PRIVATE_KEY_DEV=${REACT_APP_CLIMATE_API_PRIVATE_KEY_DEV}
ENV REACT_APP_CLIMATE_STATION_ID_DEV=${REACT_APP_CLIMATE_STATION_ID_DEV}

WORKDIR /app_build

COPY . /app_build

RUN yarn install

RUN yarn build
RUN yarn global add serve

FROM umputun/nginx-le:latest

WORKDIR /app

COPY --from=build /app_build /app
